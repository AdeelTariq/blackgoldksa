<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Gold Construction - Project Gallery</title>
    
    <!-- Favicon --><link rel="icon" type="image/png" href="favico.png">
    
    <!-- Load Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Configuration --><script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'header': '#000000CC',          /* Header color */
                'black-primary': '#000000',     /* Pure Black */
                'black-secondary': '#0D0D0D',   /* Very Deep Grey/Black for contrast sections */
                'gold-accent': '#faa412',       /* Deeper, more classic Gold */
                'gold-hover': '#AE933B',        /* Darker Gold for hover state */
              },
              fontFamily: {
                'sans': ['Roboto', 'sans-serif'],
                'display': ['Oswald', 'sans-serif'],
              },
            }
          }
        }
    </script>
    
    <!-- Load Custom Fonts --><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Dark Overlay for Hero Text Readability */
        .hero-overlay {
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.5)), url('images/slider2.jpg') no-repeat center center/cover;
            padding-top: 8rem;
            padding-bottom: 8rem;
        }

        /* To override Tailwind's default list-style behavior for the navigation */
        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* Gallery Grid Item Hover Effect */
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem; /* rounded-xl */
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.5);
        }

        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0));
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
        }

        .gallery-item:hover .gallery-caption {
            transform: translateY(0);
        }

        /* New styles for horizontal scroller */
        .scroller-container {
            position: relative;
        }

        .horizontal-scroller {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding-left: calc((100vw - 1280px) / 2 + 1rem); /* Align with max-w-7xl container */
            padding-bottom: 1rem; /* Space for content below if needed, and to avoid cutting shadows */
            /* Hide scrollbar for a cleaner look */
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        .horizontal-scroller::-webkit-scrollbar {
            display: none;  /* Chrome, Safari, and Opera */
        }

        .scroller-item {
            flex: 0 0 auto; /* Prevent items from shrinking */
            width: 22%; /* 5 items on large screens */
            padding: 0 0.5rem;
        }
        @media (max-width: 1024px) {
            .scroller-item { width: 25%; } /* Adjust for tablets (4 items) */
        }
        @media (max-width: 1280px) { /* When viewport is smaller than max-w-7xl */
            .horizontal-scroller {
                padding-left: 1rem; /* Corresponds to px-4 */
                padding-right: 1rem; /* Add padding to the right on smaller screens */
            }
        }
        @media (max-width: 768px) {
            .scroller-item { width: 33.33%; } /* Adjust for mobile (3 items) */
        }

        
        /* Lightbox Overlay Styles */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
    </style>
    <style>
        /* Floating WhatsApp Button */
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 40px;
            right: 40px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            box-shadow: 2px 2px 6px #00000040;
            z-index: 100;
            transition: transform 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .whatsapp-float:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="font-sans bg-black-primary text-white min-h-screen overflow-x-hidden">

    <!-- Header & Navigation --><header class="bg-header border-b border-gold-accent sticky top-0 z-50">
        <div class="pt-5">
            <!-- Top Bar: Logo and Mobile Menu Button --><div class="max-w-7xl mx-auto flex justify-between items-center">
                <a href="/" class="mb-2 px-4 inline-flex items-center space-x-2 text-3xl text-gold-accent font-extrabold tracking-widest font-display p-0">
                    <img src="images/logo.jpg" class="w-16 h-auto mx-auto" alt="Logo"/>
                    <span>BLACK GOLD CONSTRUCTION</span>
                </a>
                
                <!-- Mobile Menu Toggle Button --><button id="menu-toggle" class="md:hidden text-white hover:text-white transition duration-300 p-2 rounded-lg">
                    <!-- Hamburger Icon (Simple SVG) --><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
            
            <!-- Navigation Links (Collapsible) --><nav id="nav-menu" class="mt-2 hidden md:block w-full bg-gold-accent">
                <ul class="pt-4 pb-2 px-4 nav-list flex flex-col space-y-3 md:flex-row md:space-x-6 md:space-y-0 mt-5 md:mt-0 md:justify-center">
                    <li><a href="/" class="px-2 pb-2  text-stone-900 text-lg font-medium hover:text-stone-800 hover:border-b-4 hover:border-stone-600 pb-1 transition duration-300">Home</a></li>
                    <li><a href="team" class="px-2 pb-2  text-stone-900 text-lg font-medium hover:text-stone-800 hover:border-b-4 hover:border-stone-600 pb-1 transition duration-300">Team</a></li>
                    <li><a href="services" class="px-2 pb-2  text-stone-900 text-lg font-medium hover:text-stone-800 hover:border-b-4 hover:border-stone-600 pb-1 transition duration-300">Services</a></li>
                    <li><a href="projects" class="px-2 pb-2  text-stone-900 text-lg font-medium hover:text-stone-800 hover:border-b-4 hover:border-stone-600 pb-1 transition duration-300">Projects</a></li>
                    <!-- Active Link --><li><a href="#" class="px-2 pb-2 text-stone-800 text-lg font-medium hover:text-stone-800 border-b-4 border-stone-600 pb-1 transition duration-300">Gallery</a></li>
                    <li><a href="careers" class="px-2 pb-2  text-stone-900 text-lg font-medium hover:text-stone-800 hover:border-b-4 hover:border-stone-600 pb-1 transition duration-300">Careers</a></li>
                    <li><a href="contact" class="px-2 pb-2  text-stone-900 text-lg font-medium hover:text-stone-800 hover:border-b-4 hover:border-stone-600 pb-1 transition duration-300">Contact Us</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Gallery Hero Section --><section class="hero-overlay text-center">
        <div class="max-w-4xl mx-auto px-4">
            <h1 class="font-display text-5xl md:text-6xl text-gold-accent mb-4 leading-tight uppercase font-bold">
                PROJECT PHOTO GALLERY
            </h1>
            <p class="text-xl text-gray-200">
                A visual showcase of our expertise across Civil, Mechanical, and E&I fields. Every image represents a successful phase of work.
            </p>
        </div>
    </section>

    <!-- Main Gallery Grid -->
    <main class="bg-black-secondary py-20">
        <!-- Container for dynamic headings and image grids -->
        <div id="gallery-container" class="w-full">
            <!-- Headings and image grids will be generated here by JS -->
        </div>
    </main>

    <!-- Image Lightbox Modal (Hidden by Default) -->
    <div id="lightbox-modal" class="lightbox-overlay" onclick="closeLightbox(event)">
        <div class="relative max-w-6xl w-full h-full p-4 md:p-8 flex items-center justify-center">
            
            <!-- Close Button -->
            <button id="close-btn" onclick="closeLightbox(event)" class="absolute top-4 right-4 text-gold-accent hover:text-white transition duration-300 z-30 p-2 rounded-full bg-black/50">
                <!-- X Icon --><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <!-- Image Container -->
            <div onclick="event.stopPropagation()" class="relative w-full h-full max-h-[85vh] flex items-center justify-center">
                <img id="lightbox-image" src="" alt="Project Gallery Image" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl transition-opacity duration-300">
                
                <!-- Image Caption/Context -->
                <div id="lightbox-caption" class="absolute bottom-0 left-0 right-0 bg-black/70 p-4 rounded-b-lg">
                    <p id="lightbox-project-title" class="text-lg font-display text-gold-accent font-bold uppercase"></p>
                    <p id="lightbox-index" class="text-sm text-gray-300"></p>
                </div>

                <!-- Navigation Buttons -->
                <button onclick="navigateImage(-1)" id="prev-btn" class="absolute left-0 top-1/2 transform -translate-y-1/2 ml-2 bg-black/50 text-white p-3 hover:bg-black/80 transition duration-300 rounded-full disabled:opacity-30 disabled:cursor-not-allowed z-10">
                    <!-- Chevron Left --><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <button onclick="navigateImage(1)" id="next-btn" class="absolute right-0 top-1/2 transform -translate-y-1/2 mr-2 bg-black/50 text-white p-3 hover:bg-black/80 transition duration-300 rounded-full disabled:opacity-30 disabled:cursor-not-allowed z-10">
                    <!-- Chevron Right --><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
        </div>
    </div>


    <!-- Footer --><footer class="bg-black-secondary py-16 border-t border-gold-accent">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 text-left">
                
                <!-- Column 1: Logo & Company Description -->
                <div class="md:col-span-2">
                    <a href="/" class="inline-flex items-center space-x-2 text-3xl text-gold-accent font-extrabold tracking-widest font-display p-0 mb-4">
                        <img src="images/logo.jpg" class="w-16 h-auto mx-auto" alt="Logo"/>
                    <span>BLACK GOLD CONSTRUCTION</span>
                    </a>
                    <p class="text-sm text-gray-400 mb-6">
                        Leading provider of industrial services specializing in Civil, Mechanical, and E&I solutions across the Kingdom of Saudi Arabia.
                    </p>
                    <div class="space-x-4">
                        <!-- Social Links -->
                        <a href="#" aria-label="LinkedIn" class="text-gold-accent text-2xl hover:text-gold-hover transition duration-300"><i class="fab fa-linkedin"></i></a>
                        <a href="#" aria-label="Twitter" class="text-gold-accent text-2xl hover:text-gold-hover transition duration-300"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Facebook" class="text-gold-accent text-2xl hover:text-gold-hover transition duration-300"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>

                <!-- Column 2: Quick Links (Navigation) -->
                <div>
                    <h4 class="text-xl font-display text-gold-accent mb-4 uppercase font-bold">Quick Links</h4>
                    <div class="flex space-x-8">
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-gold-accent transition duration-300">Home</a></li>
                        <li><a href="team" class="hover:text-gold-accent transition duration-300">Team</a></li>
                        <li><a href="services" class="hover:text-gold-accent transition duration-300">Services</a></li>
                        <li><a href="projects" class="hover:text-gold-accent transition duration-300">Projects</a></li>
                    </ul>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="gallery" class="hover:text-gold-accent transition duration-300">Gallery</a></li>
                        <li><a href="careers" class="hover:text-gold-accent transition duration-300">Careers</a></li>
                        <li><a href="contact" class="hover:text-gold-accent transition duration-300">Contact Us</a></li>
                    </ul>
                    </div>
                </div>

                <!-- Column 3: Contact & Location -->
                <div>
                    <h4 class="text-xl font-display text-gold-accent mb-4 uppercase font-bold">Contact Details</h4>
                    <ul class="space-y-4 text-gray-400 text-sm">
                        <li class="flex items-start space-x-3">
                            <!-- Location Icon --><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-gold-accent mt-0.5 flex-shrink-0"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                            <!-- Location and Map Link --><a href="https://maps.google.com/?q=27.0097093,49.6563017" target="_blank" rel="noopener noreferrer" class="flex-1 hover:text-gold-accent transition duration-300">Makkah street, Number 3348, Additional number 8124
Zip code 35514, Jubail Eastern Region KSA</a>
                        </li>
                        <li class="flex items-center space-x-3">
                            <!-- Phone Icon --><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-gold-accent flex-shrink-0"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 3.08 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                            <!-- Phone Number --><span><a href="tel:+966509702239" class="hover:text-gold-accent transition duration-300">+966 50 970 2239</a></span>
                        </li>
                        <li class="flex items-center space-x-3">
                            <!-- Mail Icon --><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-gold-accent flex-shrink-0"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-10 7-10-7"/></svg>
                            <span>For Bidding & Proposals: <a href="mailto:tenders@blackgoldksa.com" class="hover:text-gold-accent transition duration-300">tenders@blackgoldksa.com</a>
                                <br>For Info: <a href="mailto:info@blackgoldksa.com" class="hover:text-gold-accent transition duration-300">info@blackgoldksa.com</a></span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Legal/Copyright Line -->
            <div class="mt-12 pt-8 border-t border-black-primary text-center text-gray-500 text-sm">
                <p>&copy; 2025 BLACK GOLD CONSTRUCTION Company. All rights reserved. | <a href="#" class="hover:text-gold-accent transition duration-300">Privacy Policy</a> | <a href="#" class="hover:text-gold-accent transition duration-300">Terms of Use</a></p>
            </div>
        </div>
    </footer>

    <!-- Font Awesome for social icons --><script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script>
        // --- Project Data Structure (Cleaned up to keep only ID, Title, and Images) ---
        const projectsData = [
            {
                id: -10,
                title: "Office Interior",
                images: [
                    "projects/office14.jpeg",    
                    "projects/office15.jpeg",
                    "projects/office12.jpeg",
                    "projects/office13.jpeg",
                    "projects/office16.jpeg",
                ]
            },
            {
                id: -5,
                title: "Workshop Facility",
                images: [
                    "projects/workshop31.jpeg",
                    "projects/workshop32.jpeg",
                    "projects/workshop33.jpeg",
                    "projects/workshop34.jpeg",
                ]
            },
            // --- Main Projects ---
            {
                id: 1,
                title: "CONSTRUCTION OF SWCC TANK",
                images: [
                    "projects/one.png"
                ]
            },{
                id: 2,
                title: "BOTTOM REPLACEMENT OF DEMIN WATER TANK (UNITED)",
                images: [
                    "projects/two.png"
                ]
            },{
                id: 3,
                title: "FABRICATION & REPLACEMENT OF PIPING & STR VALVE STATIONS...",
                images: [
                    "projects/three-3.png",
                    "projects/three-4.png",
                ]
            },
            {
                id: 4,
                title: "FABRICATION/INSTALLATION OF RTR LINE",
                images: [
                    "projects/four.png",
                ]
            },
            {
                id: 5,
                title: "CONSTRUCTION OF 42” DOWN STREAM PIPELINE",
                images: [
                    "projects/five.png",
                ]
            },
            {
                id: 6,
                title: "FABRICAITON & REPLACEMENT OF PP DISCHARGE VESSEL & STR",
                images: [
                    "projects/six-1.png",
                    "projects/six-2.png",
                    "projects/six-3.png",
                    "projects/six-4.png",
                ]
            },
            {
                id: 7,
                title: "REPLACEMENT OF HEAT EXCHANGERS",
                images: [
                    "projects/seven.png",
                ]
            },
            {
                id: 8,
                title: "EXCHANGER SHELL REPAIR WORK & TCF DEVELOPMENT",
                images: [
                    "projects/eight.png",
                ]
            },
            // --- Specialized Capabilities (Now treated as general projects) ---
            {
                id: 9,
                title: "PRE-CASTING OF FOUNDATIONS",
                images: [
                    "projects/nine-1.png",
                    "projects/nine-3.png",
                    "projects/nine-4.png",
                ]
            },
            {
                id: 10,
                title: "CASTING OF STRUCTURAL COLUMNS",
                images: [
                    "projects/ten.png",
                ]
            },
            {
                id: 11,
                title: "TCF DEVELOPMENT",
                images: [
                    "projects/eleven-1.png",
                    "projects/eleven-2.png",
                ]
            }
        ];

        let flattenedGallery = []; // Used to store ALL images for lightbox navigation
        let currentImageIndex = 0;

        /**
         * Scrolls a given carousel container horizontally.
         * @param {string} containerId - The ID of the .horizontal-scroller element.
         * @param {number} direction - -1 for left, 1 for right.
         */
        function scrollCarousel(containerId, direction) {
            const container = document.getElementById(containerId);
            if (container) {
                // Scroll by 75% of the container's visible width
                const scrollAmount = container.clientWidth * 0.75 * direction;
                container.scrollBy({ left: scrollAmount, behavior: 'smooth' });

                // After scrolling, wait a moment for the scroll to finish and then update the buttons.
                setTimeout(() => {
                    updateScrollButtons(container);
                }, 500); // 500ms delay to allow smooth scroll to complete
            }
        }

        /**
         * Updates the visibility of scroll buttons based on the scroller's position.
         * @param {HTMLElement} scroller - The .horizontal-scroller element.
         */
        function updateScrollButtons(scroller) {
            const parentContainer = scroller.parentElement;
            if (!parentContainer) return;

            const prevButton = parentContainer.querySelector('.carousel-prev-btn');
            const nextButton = parentContainer.querySelector('.carousel-next-btn');

            if (!prevButton || !nextButton) return;

            const scrollLeft = scroller.scrollLeft;
            const scrollWidth = scroller.scrollWidth;
            const clientWidth = scroller.clientWidth;

            // Hide prev button if at the beginning
            prevButton.disabled = scrollLeft < 1;

            // Hide next button if at the end (with a 1px tolerance)
            nextButton.disabled = scrollWidth - scrollLeft - clientWidth < 1;
        }

        // --- Core Functions ---

        /**
         * Renders the image gallery with custom headings based on project index.
         * The function also flattens all images into the `flattenedGallery` array for the lightbox.
         */
        function renderGallery() {
            const container = document.getElementById('gallery-container');
            container.innerHTML = ''; 
            flattenedGallery = []; // Reset gallery for flattening
            
            let htmlContent = '';
            let lastSection = null;
            
            // Pre-calculate image counts for each section to determine if buttons are needed
            const officeImagesCount = projectsData[0] ? projectsData[0].images.length : 0;
            const workshopImagesCount = projectsData[1] ? projectsData[1].images.length : 0;
            const projectImagesCount = projectsData.slice(2).reduce((acc, project) => acc + (project.images ? project.images.length : 0), 0);

            if (projectsData.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-400">No project images available to display in the gallery.</p>';
                return;

            }

            projectsData.forEach((project, projectIndex) => {
                let currentSection;

                if (projectIndex === 0) {
                    currentSection = "Our Office";
                } else if (projectIndex === 1) {
                    currentSection = "Workshop";
                } else {
                    currentSection = "Projects";
                }
                
                // Check if the section header needs to be rendered
                // This ensures "Projects" only gets one header, and others get their specific header.
                if (currentSection !== lastSection) {
                    // Close the previous grid container if it existed
                    if (lastSection !== null) { 
                        let lastSectionImageCount = 0;
                        if (lastSection === "Our Office") lastSectionImageCount = officeImagesCount;
                        else if (lastSection === "Workshop") lastSectionImageCount = workshopImagesCount;
                        else lastSectionImageCount = projectImagesCount;

                        const showLastButtons = lastSectionImageCount >= 5;

                        htmlContent += `
                            </div> <!-- Close horizontal-scroller -->
                            <!-- Next Button -->
                            <button 
                                onclick="scrollCarousel('scroller-${lastSection.replace(/\s+/g, '-')}', 1)" 
                                class="carousel-next-btn absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/60 text-white p-3 hover:bg-gold-accent transition duration-300 rounded-full z-10 ${showLastButtons ? 'hidden md:block' : 'hidden'}"
                            >
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div></div>`; // Close scroller-container and the outer div
                    }
                    
                    const scrollerId = `scroller-${currentSection.replace(/\s+/g, '-')}`;
                    // Render new header and start a new grid container

                    let imageCountForSection = 0;
                    if (currentSection === "Our Office") imageCountForSection = officeImagesCount;
                    else if (currentSection === "Workshop") imageCountForSection = workshopImagesCount;
                    else imageCountForSection = projectImagesCount;

                    const showButtons = imageCountForSection >= 5;

                    htmlContent += `
                        <div class="mb-12">
                            <div class="max-w-7xl mx-auto px-4">
                                <h2 class="text-3xl font-display text-gold-accent mb-6 uppercase font-bold">${currentSection}</h2>
                            </div>
                            <div class="scroller-container">
                                <!-- Prev Button -->
                                <button 
                                    onclick="scrollCarousel('${scrollerId}', -1)" 
                                    class="carousel-prev-btn absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/60 text-white p-3 hover:bg-gold-accent transition duration-300 rounded-full z-10 ${showButtons ? 'hidden md:block' : 'hidden'} disabled:opacity-30 disabled:cursor-not-allowed"
                                >
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                </button>

                                <div id="${scrollerId}" class="horizontal-scroller">
                    `;
                    lastSection = currentSection;
                }

                // Render images for the current project within the current section's grid
                if (project.images && project.images.length > 0) {
                    project.images.forEach(imagePath => {
                        const imageIndex = flattenedGallery.length; // The index for the lightbox
                        
                        // 1. Add to flattenedGallery for lightbox (essential for navigation)
                        flattenedGallery.push({
                            src: imagePath,
                            projectTitle: project.title
                        });

                        // 2. Render grid item
                        htmlContent += `
                            <div class="scroller-item">
                                <div class="gallery-item" onclick="openLightbox(${imageIndex})">
                                <img src="${imagePath}" alt="${project.title}" onerror="this.onerror=null; this.src='https://placehold.co/400x300/0D0D0D/faa412?text=Image+Loading+Error';" class="w-full h-full object-cover aspect-[4/3]">
                                <div class="gallery-caption">
                                    <p class="text-xs text-gold-accent font-semibold">${project.title}</p>
                                </div>
                            </div></div>`;
                    });
                }
            });
            
            // Close the last grid div
            if (lastSection !== null) {
                let lastSectionImageCount = 0;
                if (lastSection === "Our Office") lastSectionImageCount = officeImagesCount;
                else if (lastSection === "Workshop") lastSectionImageCount = workshopImagesCount;
                else lastSectionImageCount = projectImagesCount;

                const showLastButtons = lastSectionImageCount >= 5;

                htmlContent += `
                        </div> <!-- Close horizontal-scroller -->
                        <!-- Next Button for the last section -->
                        <button 
                            onclick="scrollCarousel('scroller-${lastSection.replace(/\s+/g, '-')}', 1)" 
                            class="carousel-next-btn absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/60 text-white p-3 hover:bg-gold-accent transition duration-300 rounded-full z-10 ${showLastButtons ? 'hidden md:block' : 'hidden'} disabled:opacity-30 disabled:cursor-not-allowed"
                        >
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>`; // Close scroller-container and outer div
            }
            
            // Inject all generated HTML into the main container
            container.innerHTML = htmlContent;

            // After rendering, attach scroll listeners to all carousels
            document.querySelectorAll('.horizontal-scroller').forEach(scroller => {
                scroller.addEventListener('scroll', () => updateScrollButtons(scroller));
                updateScrollButtons(scroller); // Set initial state
            });
        }


        /**
         * Opens the lightbox modal to the specified image index.
         * @param {number} index - The index of the image in the flattenedGallery array.
         */
        function openLightbox(index) {
            currentImageIndex = index;
            updateLightbox();
            document.getElementById('lightbox-modal').style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        /**
         * Closes the lightbox modal.
         * @param {Event} event - The click event to check if click occurred on overlay or close button.
         */
        function closeLightbox(event) {
            const lightboxModal = document.getElementById('lightbox-modal');
            
            // Check if the click occurred on the modal overlay itself or the close button/its children
            if (event.target === lightboxModal || event.target.closest('#close-btn')) {
                lightboxModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restore scrolling
            }
        }

        /**
         * Updates the image source and captions in the lightbox.
         */
        function updateLightbox() {
            if (flattenedGallery.length === 0) return;

            const imageObj = flattenedGallery[currentImageIndex];
            const totalImages = flattenedGallery.length;

            document.getElementById('lightbox-image').src = imageObj.src;
            // Add error fallback for lightbox image
            document.getElementById('lightbox-image').onerror = function() {
                this.onerror=null; 
                this.src='https://placehold.co/800x600/000000/faa412?text=Image+Not+Found';
            };
            
            document.getElementById('lightbox-project-title').textContent = imageObj.projectTitle;
            document.getElementById('lightbox-index').textContent = `Photo ${currentImageIndex + 1} of ${totalImages}`;

            // Update button states
            document.getElementById('prev-btn').disabled = currentImageIndex === 0;
            document.getElementById('next-btn').disabled = currentImageIndex === totalImages - 1;
        }

        /**
         * Navigates to the next or previous image.
         * @param {number} direction - -1 for previous, 1 for next.
         */
        function navigateImage(direction) {
            // Stop event propagation to prevent the closeLightbox function on the overlay from triggering
            event.stopPropagation();
            
            const newIndex = currentImageIndex + direction;
            if (newIndex >= 0 && newIndex < flattenedGallery.length) {
                currentImageIndex = newIndex;
                updateLightbox();
            }
        }


        // --- Event Listeners ---
        window.onload = () => {
            // Render the gallery grid with groupings when the page loads
            renderGallery();
            
            // Mobile Menu Toggle Logic
            const menuToggle = document.getElementById('menu-toggle');
            const navMenu = document.getElementById('nav-menu');
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('hidden');
                    navMenu.classList.toggle('block');
                });
            }

            // Close modal on escape key press and navigate with arrows
            document.addEventListener('keydown', (e) => {
                const isLightboxOpen = document.getElementById('lightbox-modal').style.display === 'flex';
                if (isLightboxOpen) {
                    if (e.key === 'Escape') {
                        // Simulate click on overlay element to trigger closeLightbox logic
                        // Need to pass an object that matches the event.target === lightboxModal check
                        closeLightbox({ target: document.getElementById('lightbox-modal') }); 
                    } else if (e.key === 'ArrowLeft') {
                        navigateImage(-1);
                    } else if (e.key === 'ArrowRight') {
                        navigateImage(1);
                    }
                }
            });
        };
    </script>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/966582174493" class="whatsapp-float" target="_blank" rel="noopener noreferrer" aria-label="Chat on WhatsApp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="white" width="30" height="30"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
    </a>
</body>
</html>
